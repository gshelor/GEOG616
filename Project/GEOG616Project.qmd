---
title: "GEOG616Project"
author: "Griffin Shelor"
format: html
editor: visual
---

## Quarto

Quarto enables you to weave together content and executable code into a finished document. To learn more about Quarto see <https://quarto.org>.

## Running Code

When you click the **Render** button a document will be generated that includes both content and the output of embedded code. You can embed code like this:

```{r}
library(pacman)
pacman::p_load(snotelr, sf, terra, tidyterra, tidyverse, here, crsuggest, terrainr)
## test
snoteldata_conus <- read_csv(here("snoteldata_conus.csv"))
## snotelinfo
snotelinfo <- snotel_info()
## reading in ecoregions with state boundaries
ecoregions_usb_sf <- read_sf(here("Project","Data", "L3_Ecoregions_USB", "us_eco_l3_state_boundaries.shp")) |>
  filter(STATE_NAME == "California" | STATE_NAME == "Oregon" | STATE_NAME == "Colorado" | STATE_NAME == "Idaho" | STATE_NAME == "Wyoming" | STATE_NAME == "New Mexico" | STATE_NAME == "Montana" | STATE_NAME == "Arizona" | STATE_NAME == "South Dakota" | STATE_NAME == "Nevada" | STATE_NAME == "Utah" | STATE_NAME == "Washington")
crs(ecoregions_usb_sf, describe = TRUE)
crsuggest::suggest_crs(ecoregions_usb_sf)


##### grouping data by snotel site, plotting max SWE #####
snoteldata_conus_grp <- snoteldata_conus |>
  dplyr::group_by(site_id) |>
  summarise(max_swe = max(snow_water_equivalent))

snotelinfo_conus_grp <- snotelinfo |>
  filter(site_id %in% snoteldata_conus_grp$site_id)

snoteldata_conus_grp <- merge(snoteldata_conus_grp, snotelinfo_conus_grp, by = "site_id") |>
  select(site_id, site_name, max_swe, longitude, latitude)

## converting df of max swe to sf object
snoteldata_conus_grp_sf <- st_as_sf(snoteldata_conus_grp, coords = c("longitude", "latitude"))
## using median longitude and latitude to find appropriate crs
crsuggest::guess_crs(snoteldata_conus_grp_sf, target_location = c(-111.93, 42.14))
## setting CRS with best guess
st_crs(snoteldata_conus_grp_sf) <- 26768

## transforming ecoregions to use same crs
st_transform(ecoregions_usb_sf, 26768)



crs(snoteldata_conus_grp_sf, describe = TRUE)

## creating plot of max_swe
max_swe_plot <- ggplot() +
  theme_minimal() +
  geom_sf(data = ecoregions_usb_sf) +
  geom_sf(data = snoteldata_conus_grp_sf, mapping = aes(color = max_swe))
max_swe_plot
ggsave("maxsweplot.png")

plot(st_geometry(ecoregions_usb_sf))
plot(st_geometry(snoteldata_conus_grp_sf, add = TRUE))
```

You can add options to executable code like this

```{r}
#| echo: false
2 * 2
```

The `echo: false` option disables the printing of code (only output is displayed).
